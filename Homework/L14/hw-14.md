Домашнее задание №14

Цель: Научиться выполнять оптимизировать и делать отладку каждого этапа в Bash-скриптинге.  

Задания:
    1. Повторить шаги, указанные в приведенной статье: https://andreyex.ru/linux/kak-otlazhivat-stsenarij-bash/.
    2. Повторите шаги, указанные в этой статье : https://basis.gnulinux.pro/ru/latest/basis/30/30._bash_скрипты_№4.html
Опционально:
    3. Оптимизируйте код из задания 2.

#### 1. Отлаживание сценариев bash
###### *Отлаживание выполнения (опция -x)*
```bash
#!/bin/bash
exec 5> debug_output.txt
BASH_XTRACEFD="5"
PS4='$LINENO: '
var="Привет мир!"
# печать
echo "$var"
# альтернативный способ печати
printf "%s\n" "$var"
echo "Мой дом - это: $HOME"
```
![](screenshots/Pasted%20image%2020250501183235.png)
###### *Отладка части скрипта(set –x и set + x)*
```bash
#!/bin/bash
exec 5> debug_output.txt
BASH_XTRACEFD="5"
PS4='$LINENO: '
set -x
var="Привет мир"
# печать
echo "$var"
# альтернативный способ печати
printf "%s\n" "$var"
set +xsudo apt install lsscsi
echo "Мой дом - это: $HOME"
```
![](screenshots/Pasted%20image%2020250501184111.png)
###### *Отключение оболочки (параметр -n)*
%% Включает режим проверки синтаксиса. Он указывает оболочке не выполнять команды, а просто проверять синтаксические ошибки.%%
```bash
#!/bin/bash
var="Привет мир"
echo "$var"
echo "Мой домашний каталог is=$HOME
echo "Мое имя is=$USER"
```
![](screenshots/Pasted%20image%2020250501184840.png)
###### *Отображение команд сценария (параметр -v)*
%%-v (сокращение от verbose) указывает оболочке работать в подробном режиме. При использовании этого режима он отображает все команды в сценарии перед их выполнением.%%
![](screenshots/Pasted%20image%2020250501185117.png)
#### 2. Выполнил по видео bash скрипты N1-4
``` bash
#!/usr/bin/env bash

# Checking root permissions
if [ "$(id -u)" != 0 ]
	then
	echo root permissions required >&2
	exit 1
fi
# Variables
shell=/sbin/nologin
file=/var/users
oldIFS=$IFS

#Function for create user and group
create_user() {

IFS=$oldIFS
groupadd $group
# Sudoers
if [ "$group" = it ] || [ "$group" = security ]
then
	if ! grep "%$group" /etc/sudoers
	then
	cp /etc/sudoers{,.bkp}
	echo '%'$group' ALL=(ALL) ALL' >> /etc/sudoers
	fi
	shell=/bin/bash
elif [ "$user" = admin ]
then
	if ! grep "$user" /etc/sudoers
	then
	cp /etc/sudoers{,.bkp}
	echo "$user ALL=(ALL) ALL" >> /etc/sudoers
	fi
	shell=/bin/bash
fi

mkdir /home/$group
useradd $user -g $group -b /home/$group -s $shell
}

# Check parameters
if [ ! -z $2 ]
then
	user=$1
	group=$2
	echo Username: $user Group: $group
	create_user
elif [ -f $file ]
then
	IFS=$'\n'
	for line in $(cat /var/users)
	do
		user=$(echo $line | cut -d ' ' -f1)
		group=$(echo $line | cut -d ' ' -f2)
		create_user
		echo Username: $user Group: $group
	done
else
	echo Welcome!
	select option in "Add user" "Show users" "Exit"
	do case $option in
	"Add user")
		read -p "Print username: " user
		read -p "Print groupname: " group
		create_user ;;
	"Show users")
		cut -d: -f1 /etc/passwd ;;
	"Exit")
		break ;;
	*)
		echo Wrong option ;;
esac
done
fi
```