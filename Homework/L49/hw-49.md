**Цель:** Ознакомиться с установкой и настройкой Prometheus, а также изучить экспортеры и их использование.

## Задание:

### 1. Установка Prometheus:
a. Исследуйте официальный сайт Prometheus (https://prometheus.io/) и найдите раздел "Downloads" (Загрузки).  
b. Выберите версию Prometheus, соответствующую вашей операционной системе.  
c. Следуйте инструкции по установке Prometheus на свою операционную систему.  

```bash
sudo mv ~/prometheus-3.5.0.linux-amd64 /opt/prometheus
```

```bash
sudo useradd --no-create-home --shell /bin/false prometheus
```

```bash
sudo chown -R prometheus:prometheus /opt/prometheus
```

```bash
sudo nano /etc/systemd/system/prometheus.service
```

Вставьте следующее:

```ini
[Unit]
Description=Prometheus Server
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/opt/prometheus/prometheus \
    --config.file=/opt/prometheus/prometheus.yml \
    --storage.tsdb.path=/opt/prometheus/data \
    --web.listen-address=0.0.0.0:9090

Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload
sudo systemctl enable prometheus
sudo systemctl start prometheus
```

```bash
sudo systemctl status prometheus
```

d. Проверьте, что Prometheus успешно установлен, запустив его и открыв веб-интерфейс в браузере.

```
http://<ваш_IP>:9090
```


![](screenshots/Pasted%20image%2020250905220511.png)

### 2. Настройка Prometheus:
a. Изучите файл конфигурации Prometheus, который обычно называется "prometheus.yml". Он содержит настройки для сбора метрик.  
b. Откройте файл конфигурации и изучите различные секции и параметры.  
c. Внесите необходимые изменения в файл конфигурации, чтобы настроить сбор метрик с различных источников. Например, вы можете добавить конфигурацию для сбора метрик с Node Exporter или другого экспортера.  
d. Сохраните файл конфигурации и перезапустите Prometheus, чтобы применить изменения.

```yaml
#prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # Мониторинг самого Prometheus
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # Мониторинг Node Exporter (метрики сервера)
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['localhost:9100']  # Порт по умолчанию для Node Exporter
```
### 3. Экспортеры:
a. Изучите список популярных экспортеров Prometheus, таких как Node Exporter, Blackbox Exporter, Prometheus MySQL Exporter и другие.  
b. Выберите один или несколько экспортеров, которые вам интересны.  
c. Изучите документацию и инструкции по установке и настройке выбранных экспортеров.  
d. Установите и настройте выбранные экспортеры на своей системе. 
##### *Blackbox Exporter — проверка доступности сайтов

#### Установка:

```bash
cd /tmp
wget https://github.com/prometheus/blackbox_exporter/releases/download/v0.24.0/blackbox_exporter-0.24.0.linux-amd64.tar.gz
tar -xzf blackbox_exporter-*.tar.gz
sudo mv blackbox_exporter-*/blackbox_exporter /usr/local/bin/
sudo useradd --no-create-home --shell /bin/false blackbox_exporter
```

```bash
sudo mkdir -p /etc/blackbox_exporter
sudo nano /etc/blackbox_exporter/config.yml
```

```yaml
#config.yml
modules:
  http_2xx:
    prober: http
    timeout: 5s
    http:
      valid_status_codes: [200, 301, 302]
      method: GET
  icmp:
    prober: icmp
    timeout: 5s
```

##### Создание сервиса:

```bash
sudo nano /etc/systemd/system/blackbox_exporter.service
```

```ini
[Unit]
Description=Blackbox Exporter
After=network.target

[Service]
User=blackbox_exporter
ExecStart=/usr/local/bin/blackbox_exporter \
  --config.file=/etc/blackbox_exporter/config.yml \
  --web.listen-address=:9115
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload
sudo systemctl enable blackbox_exporter
sudo systemctl start blackbox_exporter
```

e. Проверьте, что экспортеры успешно работают и Prometheus собирает метрики с добавленных экспортеров.

![](screenshots/Pasted%20image%2020250906182558.png)

![](screenshots/Pasted%20image%2020250906180806.png)

f. Исследуйте доступные метрики и запросы PromQL, чтобы извлекать и анализировать данные с использованием собранных метрик.

*Откройте Prometheus → Graph → попробуйте запросы:

### Blackbox Exporter:

```promql
# Время ответа HTTP
probe_duration_seconds{job="blackbox"}

# Статус проверки (1 = OK, 0 = FAIL)
probe_success{job="blackbox"}
```

![](screenshots/Pasted%20image%2020250906181039.png)

### 4. Установка Graphana:


```bash
# Установите зависимости
sudo apt-get update
sudo apt-get install -y apt-transport-https software-properties-common wget

# Импортируйте GPG-ключ
wget -q -O - https://apt.grafana.com/gpg.key | sudo gpg --dearmor -o /usr/share/keyrings/grafana.gpg

# Добавьте репозиторий (для стабильной версии)
echo "deb [signed-by=/usr/share/keyrings/grafana.gpg] https://apt.grafana.com stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list

# Обновите пакеты
sudo apt-get update
sudo apt-get install -y grafana
sudo systemctl daemon-reload
sudo systemctl enable grafana-server
sudo systemctl start grafana-server
```

![](screenshots/Pasted%20image%2020250906165733.png)


![](screenshots/Pasted%20image%2020250906182707.png)